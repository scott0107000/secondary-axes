let data={hanzi:"林",font:"",upm:1e3,baseline:150,facew:96,faceh:96,medw:40,medh:40,overshoot:true,weightmix:.5,hweight:.2,vweight:.2};function syncUI2Data(){data.hanzi=$("#hanzi-input").val();data.upm=parseFloat($("#upm-input").val());data.baseline=parseFloat($("#baseline-input").val());data.facew=parseFloat($("#facew-input").val());data.faceh=parseFloat($("#faceh-input").val());data.medw=parseFloat($("#medw-input").val());data.medh=parseFloat($("#medh-input").val());data.overshoot=$("#overshoot-input").is(":checked");data.weightmix=parseFloat($("#weightmix-input").val());data.hweight=parseFloat($("#hweight-input").val());data.vweight=parseFloat($("#vweight-input").val());const a=$("#font-input").val();try{if(a===""||a===undefined){data.font="";$("#glyph-box").css({fontFamily:""})}else if(!document.fonts.check("12px "+a)){M.toast({html:`不支持的字体：${a}`});data.font="";$("#glyph-box").css({fontFamily:""})}else{data.font=a;$("#glyph-box").css({fontFamily:a})}}catch{M.toast({html:`不支持的字体：${a}`});$("#glyph-box").css({fontFamily:""})}$("#glyph-box").text(data.hanzi);if($("#showref-input").is(":checked")){$("#glyph-box").css({display:""})}else{$("#glyph-box").css({display:"none"})}updatePreview(data);localStorage.setItem("secondMedialData",JSON.stringify(data))}function syncData2UI(a){$("#hanzi-input").val(a.hanzi);$("#font-input").val(a.font);$("#upm-input").val(a.upm);$("#baseline-input").val(a.baseline);$("#facew-input").val(a.facew);$("#faceh-input").val(a.faceh);$("#medw-input").val(a.medw);$("#medh-input").val(a.medh);$("#overshoot-input").prop("checked",a.overshoot);$("#weightmix-input").val(a.weightmix);$("#hweight-input").val(a.hweight);$("#vweight-input").val(a.vweight)}function updatePreview(a){const t=$("#em-box").width(),e=$("#em-box").height();const s=t*a.facew/100,i=e*a.faceh/100;$("#face-box").css({width:s+"px",height:i+"px",left:(t-s)/2+"px",top:(e-i)/2+"px"});const{axes:[o,l,h,n],status:r}=evaluateAxes(a);switch(r){case"unknownIDS":{M.toast({html:"第二中心线理论不支持的构字，或拆字后部件过于生僻"});$("#h-axes").addClass("gray-out");$("#v-axes").addClass("gray-out");$("#h1-val").addClass("gray-out");$("#h2-val").addClass("gray-out");$("#v1-val").addClass("gray-out");$("#v2-val").addClass("gray-out")}break;case"unknownComplexity":{M.toast({html:"数据加载出现问题"});$("#h-axes").addClass("gray-out");$("#v-axes").addClass("gray-out");$("#h1-val").addClass("gray-out");$("#h2-val").addClass("gray-out");$("#v1-val").addClass("gray-out");$("#v2-val").addClass("gray-out")}break;case"horizontal":{$("#h-axes").removeClass("gray-out");$("#v-axes").addClass("gray-out");$("#h1-val").removeClass("gray-out");$("#h2-val").removeClass("gray-out");$("#v1-val").addClass("gray-out");$("#v2-val").addClass("gray-out")}break;case"vertical":{$("#h-axes").addClass("gray-out");$("#v-axes").removeClass("gray-out");$("#h1-val").addClass("gray-out");$("#h2-val").addClass("gray-out");$("#v1-val").removeClass("gray-out");$("#v2-val").removeClass("gray-out")}break;case"done":{$("#h-axes").removeClass("gray-out");$("#v-axes").removeClass("gray-out");$("#h1-val").removeClass("gray-out");$("#h2-val").removeClass("gray-out");$("#v1-val").removeClass("gray-out");$("#v2-val").removeClass("gray-out")}break}$("#h-axes").css({height:`${(l-o)*e}px`,top:`${o*e}px`});$("#v-axes").css({width:`${(n-h)*t}px`,left:`${h*t}px`});$("#h1-val").text(Math.round(a.upm*(1-o))-a.baseline);$("#h1-val").css({top:`${o*e}px`,transform:"translateY(-50%)"});$("#h2-val").text(Math.round(a.upm*(1-l))-a.baseline);$("#h2-val").css({top:`${l*e}px`,transform:"translateY(-50%)"});$("#v1-val").text(Math.round(h*a.upm));$("#v1-val").css({left:`${h*t}px`,transform:"translateX(-50%)"});$("#v2-val").text(Math.round(n*a.upm));$("#v2-val").css({left:`${n*t}px`,transform:"translateX(-50%)"})}function evaluateAxes(a){let t=a.medw/100,e=a.medh/100;const s=idsData[a.hanzi];if(typeof s!=="string")return{axes:[.5-e/2,.5+e/2,.5-t/2,.5+t/2],status:"unknownIDS"};let i=1,o=1,l=1,h=1;const n=complexityData[[...s][1]];const r=complexityData[[...s][2]];if(n===undefined||r===undefined)return{axes:[.5-e/2,.5+e/2,.5-t/2,.5+t/2],status:"unknownComplexity"};if(a.overshoot){const d=3236,g=933;const v=3529,m=1170;const u=n[1]+r[1];const x=n[2]+r[2];const c=(u-d)/g;const p=2/(1+Math.exp(-c*25/12))-1;const $=(x-v)/m;const w=2/(1+Math.exp(-$*25/11))-1;t*=1+p/20;e*=1+w/20}switch(s[0]){case"⿰":l=(a.weightmix*n[1]+(1-a.weightmix)*n[0])*(1-a.hweight);h=a.weightmix*r[1]+(1-a.weightmix)*r[0];break;case"⿱":i=(a.weightmix*n[2]+(1-a.weightmix)*n[0])*(1-a.vweight);o=a.weightmix*r[2]+(1-a.weightmix)*r[0];break;case"⿸":l=(a.weightmix*n[1]+(1-a.weightmix)*n[0])*(1-a.hweight);h=a.weightmix*r[1]+(1-a.weightmix)*r[0];i=(a.weightmix*n[2]+(1-a.weightmix)*n[0])*(1-a.vweight);o=a.weightmix*r[2]+(1-a.weightmix)*r[0];break;case"⿹":l=(a.weightmix*r[1]+(1-a.weightmix)*r[0])*(1-a.hweight);h=a.weightmix*n[1]+(1-a.weightmix)*n[0];i=(a.weightmix*n[2]+(1-a.weightmix)*n[0])*(1-a.vweight);o=a.weightmix*r[2]+(1-a.weightmix)*r[0];break;case"⿺":l=(a.weightmix*n[1]+(1-a.weightmix)*n[0])*(1-a.hweight);h=a.weightmix*r[1]+(1-a.weightmix)*r[0];i=(a.weightmix*r[2]+(1-a.weightmix)*r[0])*(1-a.vweight);o=a.weightmix*n[2]+(1-a.weightmix)*n[0];break;default:return{axes:[.5-e/2,.5+e/2,.5-t/2,.5+t/2],status:"unknownIDS"}}return{axes:[.5-e*o/(i+o),.5+e*i/(i+o),.5-t*h/(l+h),.5+t*l/(l+h)],status:s[0]==="⿱"?"horizontal":s[0]==="⿰"?"vertical":"done"}}let hanzi="林";let idsData={},complexityData={};const idsPromise=$.getJSON("./data/ids_simple.json").then(a=>idsData=a);const compPromise=$.getJSON("./data/glyph_complexities.json").then(a=>complexityData=a);$.when(idsPromise,compPromise).then(()=>{const a=localStorage.getItem("secondMedialData");if(a!==null){data=JSON.parse(a);syncData2UI(data)}syncUI2Data();$("#loading").css({display:"none"})});