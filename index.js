let data={hanzi:"林",font:"",upm:1e3,baseline:150,facew:96,faceh:96,medw:40,medh:40,overshoot:true,weightmix:.5,hweight:.2,vweight:.2};function syncUI2Data(){data.hanzi=$("#hanzi-input").val();data.upm=parseFloat($("#upm-input").val());data.baseline=parseFloat($("#baseline-input").val());data.facew=parseFloat($("#facew-input").val());data.faceh=parseFloat($("#faceh-input").val());data.medw=parseFloat($("#medw-input").val());data.medh=parseFloat($("#medh-input").val());data.overshoot=$("#overshoot-input").is(":checked");data.weightmix=parseFloat($("#weightmix-input").val());data.hweight=parseFloat($("#hweight-input").val());data.vweight=parseFloat($("#vweight-input").val());const t=$("#font-input").val();try{if(t===""||t===undefined){data.font="";$("#glyph-box").css({fontFamily:""})}else if(!document.fonts.check("12px "+t)){M.toast({html:`不支持的字体：${t}`});data.font="";$("#glyph-box").css({fontFamily:""})}else{data.font=t;$("#glyph-box").css({fontFamily:t})}}catch{M.toast({html:`不支持的字体：${t}`});$("#glyph-box").css({fontFamily:""})}$("#glyph-box").text(data.hanzi);if($("#showref-input").is(":checked")){$("#glyph-box").css({display:""})}else{$("#glyph-box").css({display:"none"})}updatePreview(data);localStorage.setItem("secondMedialData",JSON.stringify(data))}function syncData2UI(t){$("#hanzi-input").val(t.hanzi);$("#font-input").val(t.font);$("#upm-input").val(t.upm);$("#baseline-input").val(t.baseline);$("#facew-input").val(t.facew);$("#faceh-input").val(t.faceh);$("#medw-input").val(t.medw);$("#medh-input").val(t.medh);$("#overshoot-input").prop("checked",t.overshoot);$("#weightmix-input").val(t.weightmix);$("#hweight-input").val(t.hweight);$("#vweight-input").val(t.vweight)}function updatePreview(t){const e=$("#em-box").width(),a=$("#em-box").height();const i=e*t.facew/100,s=a*t.faceh/100;$("#face-box").css({width:i+"px",height:s+"px",left:(e-i)/2+"px",top:(a-s)/2+"px"});const{axes:[n,h,o,l],status:m}=evaluateAxes(t);if(m==="unknownIDS")M.toast({html:"第二中心线理论不支持的构字，或拆字后部件过于生僻"});if(m==="unknownComplexity")M.toast({html:"数据加载出现问题"});$("#h-axes").css({height:`${(h-n)*a}px`,top:`${n*a}px`});$("#v-axes").css({width:`${(l-o)*e}px`,left:`${o*e}px`});$("#h1-val").text(Math.round(t.upm*(1-n))-t.baseline);$("#h1-val").css({top:`${n*a}px`,transform:"translateY(-50%)"});$("#h2-val").text(Math.round(t.upm*(1-h))-t.baseline);$("#h2-val").css({top:`${h*a}px`,transform:"translateY(-50%)"});$("#v1-val").text(Math.round(o*t.upm));$("#v1-val").css({left:`${o*e}px`,transform:"translateX(-50%)"});$("#v2-val").text(Math.round(l*t.upm));$("#v2-val").css({left:`${l*e}px`,transform:"translateX(-50%)"})}function evaluateAxes(t){let e=t.medw/100,a=t.medh/100;const i=idsData[t.hanzi];if(typeof i!=="string")return{axes:[.5-a/2,.5+a/2,.5-e/2,.5+e/2],status:"unknownIDS"};let s=1,n=1,h=1,o=1;const l=complexityData[[...i][1]];const m=complexityData[[...i][2]];if(l===undefined||m===undefined)return{axes:[.5-a/2,.5+a/2,.5-e/2,.5+e/2],status:"unknownComplexity"};if(t.overshoot){const p=3236,x=933;const c=3529,w=1170;const g=l[1]+m[1];const d=l[2]+m[2];const u=(g-p)/x;const r=2/(1+Math.exp(-u*25/12))-1;const $=(d-c)/w;const v=2/(1+Math.exp(-$*25/11))-1;e*=1+r/20;a*=1+v/20}switch(i[0]){case"⿰":h=(t.weightmix*l[1]+(1-t.weightmix)*l[0])*(1-t.hweight);o=t.weightmix*m[1]+(1-t.weightmix)*m[0];break;case"⿱":s=(t.weightmix*l[2]+(1-t.weightmix)*l[0])*(1-t.vweight);n=t.weightmix*m[2]+(1-t.weightmix)*m[0];break;case"⿸":h=(t.weightmix*l[1]+(1-t.weightmix)*l[0])*(1-t.hweight);o=t.weightmix*m[1]+(1-t.weightmix)*m[0];s=(t.weightmix*l[2]+(1-t.weightmix)*l[0])*(1-t.vweight);n=t.weightmix*m[2]+(1-t.weightmix)*m[0];break;case"⿹":h=(t.weightmix*m[1]+(1-t.weightmix)*m[0])*(1-t.hweight);o=t.weightmix*l[1]+(1-t.weightmix)*l[0];s=(t.weightmix*l[2]+(1-t.weightmix)*l[0])*(1-t.vweight);n=t.weightmix*m[2]+(1-t.weightmix)*m[0];break;case"⿺":h=(t.weightmix*l[1]+(1-t.weightmix)*l[0])*(1-t.hweight);o=t.weightmix*m[1]+(1-t.weightmix)*m[0];s=(t.weightmix*m[2]+(1-t.weightmix)*m[0])*(1-t.vweight);n=t.weightmix*l[2]+(1-t.weightmix)*l[0];break;default:return{axes:[.5-a/2,.5+a/2,.5-e/2,.5+e/2],status:"unknownIDS"}}return{axes:[.5-a*n/(s+n),.5+a*s/(s+n),.5-e*o/(h+o),.5+e*h/(h+o)],status:"done"}}let hanzi="林";let idsData={},complexityData={};const idsPromise=$.getJSON("./data/ids_simple.json").then(t=>idsData=t);const compPromise=$.getJSON("./data/glyph_complexities.json").then(t=>complexityData=t);$.when(idsPromise,compPromise).then(()=>{const t=localStorage.getItem("secondMedialData");if(t!==null){data=JSON.parse(t);syncData2UI(data)}syncUI2Data();$("#loading").css({display:"none"})});